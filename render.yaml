services:
  - type: web
    name: marshab-api
    runtime: docker
    dockerfilePath: ./Dockerfile
    dockerContext: .
    dockerCommand: conda run --no-capture-output -n marshab python -m marshab.web.server
    healthCheckPath: /api/v1/health/live
    disk:
      name: marshab-data
      mountPath: /app/data
      sizeGB: 50
    envVars:
      - key: MARSHAB_DEMO_SEED
        value: "42"
      - key: MARSHAB_WEB_RELOAD
        value: "false"
      - key: MARSHAB_CORS_ORIGINS
        sync: false
      - key: MARSHAB_ORTHO_BASEMAP_PATH
        value: /app/data/cache/hirise.tif
      - key: MARSHAB_GLOBAL_BASEMAP_STYLE
        value: blendshade
  - type: web
    name: marshab-web
    runtime: static
    buildCommand: cd webui && npm ci && npm run build
    staticPublishPath: webui/dist
    envVars:
      - key: VITE_API_URL
        value: https://marshab-api.onrender.com/api/v1
      - key: VITE_WS_URL
        value: wss://marshab-api.onrender.com
      - key: VITE_GLOBAL_BASEMAP_STYLE
        value: blendshade
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
